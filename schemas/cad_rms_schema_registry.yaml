# 2025-10-16-18-45-00
# cad_rms_integration/schema_registry.yaml
# Author: R. A. Carucci
# Purpose: Defines the canonical schema for CAD/RMS integration with field mappings, validation rules, and transformations

version: "1.0.0"
updated: "2025-10-16"
schema_name: "unified_cad_rms"

fields:
  # ==============================
  # Core Identification Fields
  # ==============================
  case_number:
    aliases:
      - "Case Number"     # RMS
      - "ReportNumberNew" # CAD
      - "CaseID"          # Future compatibility
    type: "string"
    required: true
    validation:
      regex: "^\\d{2}-\\d{6}$"
      fallback_regex: "^\\d{4}-\\d{6}$|^\\d{2}-\\d{6}[A-Z]$" # For supplements
    description: "Primary case identifier"
    example: "24-123456"
    group: "identification"

  # ==============================
  # Temporal Fields
  # ==============================
  incident_date:
    aliases:
      - "Incident Date"   # RMS
      - "cDate"           # CAD
      - "OccurredDate"    # Legacy system
    type: "date"
    required: true
    format: "%Y-%m-%d"
    description: "Date incident occurred"
    example: "2025-07-15"
    group: "temporal"
  
  call_time:
    aliases:
      - "Time of Call"    # CAD
      - "CallReceived"    # Legacy
    type: "datetime"
    required: false
    format: "%H:%M:%S"
    description: "Time call was received"
    example: "14:35:22"
    group: "temporal"
  
  dispatch_time:
    aliases:
      - "Time Dispatched" # CAD
      - "UnitDispatched"  # Legacy
    type: "datetime"
    required: false
    format: "%H:%M:%S"
    description: "Time unit was dispatched"
    example: "14:37:45"
    group: "temporal"
  
  arrival_time:
    aliases:
      - "Time Out"        # CAD
      - "UnitArrived"     # Legacy
    type: "datetime"
    required: false
    format: "%H:%M:%S"
    description: "Time unit arrived on scene"
    example: "14:42:12"
    group: "temporal"
  
  clear_time:
    aliases:
      - "Time In"         # CAD
      - "UnitCleared"     # Legacy 
    type: "datetime"
    required: false
    format: "%H:%M:%S"
    description: "Time unit cleared scene"
    example: "15:22:37"
    group: "temporal"
  
  # ==============================
  # Spatial Fields
  # ==============================
  address:
    aliases:
      - "FullAddress2"    # CAD
      - "Location"        # RMS
      - "IncidentAddress" # Legacy
    type: "string"
    required: true
    transformations:
      - "standardize_abbreviations"
      - "add_city_state"
      - "extract_block"
    validation:
      min_length: 5
    description: "Incident location"
    example: "123 MAIN ST, HACKENSACK, NJ"
    group: "spatial"
  
  address_type:
    aliases:
      - "LocationType"    # RMS
    type: "string"
    required: false
    computed: true
    enum:
      - "STREET_ADDRESS"
      - "INTERSECTION"
      - "LANDMARK"
      - "UNKNOWN"
    description: "Type of address"
    group: "spatial"

  zone:
    aliases:
      - "PDZone"          # CAD
      - "Zone"            # RMS
      - "Beat"            # Legacy
    type: "string"
    required: false
    description: "Police district zone"
    example: "Z1"
    group: "spatial"
  
  grid:
    aliases:
      - "Grid"            # CAD/RMS
      - "GridID"          # Legacy
    type: "string"
    required: false
    description: "Map grid identifier"
    example: "4B"
    group: "spatial"
  
  latitude:
    aliases:
      - "Lat"             # GIS
      - "Y"               # Legacy GIS
    type: "float"
    required: false
    computed: true
    validation:
      min: 40.0
      max: 41.0
    description: "Geocoded latitude"
    example: "40.8857"
    group: "spatial"
  
  longitude:
    aliases:
      - "Lon"             # GIS
      - "Long"            # GIS
      - "X"               # Legacy GIS
    type: "float"
    required: false
    computed: true
    validation:
      min: -74.5
      max: -73.5
    description: "Geocoded longitude"
    example: "-74.0435"
    group: "spatial"
  
  # ==============================
  # Classification Fields
  # ==============================
  incident_type:
    aliases:
      - "Incident"        # CAD
      - "Incident Type"   # RMS
      - "CallType"        # Legacy
    type: "string"
    required: true
    description: "Incident classification"
    example: "SUSPICIOUS PERSON"
    group: "classification"
  
  priority:
    aliases:
      - "Priority"        # CAD
      - "CallPriority"    # Legacy
    type: "integer"
    required: false
    validation:
      min: 1
      max: 5
    description: "Call priority (1-5)"
    example: "2"
    group: "classification"
  
  how_reported:
    aliases:
      - "HowReported"     # CAD
      - "CallSource"      # Legacy
    type: "string"
    required: false
    enum:
      - "911"
      - "WALK_IN"
      - "PHONE"
      - "SELF_INITIATED"
      - "OTHER"
    description: "How incident was reported"
    example: "911"
    group: "classification"
  
  # ==============================
  # Personnel Fields
  # ==============================
  officer:
    aliases:
      - "Officer"         # CAD
      - "Officer Name"    # RMS
      - "PrimaryOfficer"  # Legacy
    type: "string"
    required: false
    transformations:
      - "standardize_officer_name"
    description: "Primary officer"
    example: "PO J SMITH #1234"
    group: "personnel"
  
  badge_number:
    aliases:
      - "Badge"           # RMS
      - "OfficerID"       # Legacy
    type: "string"
    required: false
    computed: true
    validation:
      regex: "^\\d{4}$"
    description: "Officer badge number"
    example: "1234"
    group: "personnel"
  
  platoon:
    aliases:
      - "Platoon"         # RMS
      - "Squad"           # Legacy
    type: "string"
    required: false
    enum:
      - "A"
      - "B"
      - "C"
      - "D"
      - "OTHER"
    description: "Officer platoon assignment"
    example: "B"
    group: "personnel"
  
  # ==============================
  # Status Fields
  # ==============================
  disposition:
    aliases:
      - "Disposition"     # CAD
      - "Status"          # RMS
      - "CallDisposition" # Legacy
    type: "string"
    required: false
    enum:
      - "COMPLETE"
      - "UNFOUNDED"
      - "REPORT_TAKEN"
      - "ADVISED"
      - "ARREST"
      - "GOA"
      - "CANCELLED"
      - "UTC"
      - "OTHER"
    description: "Call disposition"
    example: "REPORT_TAKEN"
    group: "status"
  
  # ==============================
  # Integration & Quality Fields
  # ==============================
  integration_type:
    type: "string"
    required: true
    computed: true
    enum:
      - "CAD_RMS_MATCHED"
      - "CAD_ONLY"
      - "RMS_ONLY"
    description: "Integration result type"
    group: "integration"
  
  match_confidence:
    type: "string"
    required: true
    computed: true
    enum:
      - "HIGH"    # Direct case number match
      - "MEDIUM"  # Secondary field match
      - "LOW"     # Fuzzy match
      - "NONE"    # No match
    description: "Confidence in CAD/RMS matching"
    group: "integration"
  
  data_quality_score:
    type: "integer"
    required: true
    computed: true
    validation:
      min: 0
      max: 100
    description: "Overall data quality score"
    example: "85"
    group: "quality"
  
  data_source:
    type: "string"
    required: true
    enum:
      - "CAD"
      - "RMS"
      - "UNIFIED"
    description: "Data source system"
    group: "metadata"
  
  source_file:
    type: "string"
    required: true
    description: "Source file name"
    example: "2025_07_CAD.xlsx"
    group: "metadata"
  
  processing_timestamp:
    type: "datetime"
    required: true
    computed: true
    description: "When record was processed"
    group: "metadata"
  
  pipeline_version:
    type: "string"
    required: true
    computed: true
    description: "Processing pipeline version"
    example: "2025.10.16"
    group: "metadata"

# ==============================
# Transformation Definitions
# ==============================
transformations:
  standardize_abbreviations:
    description: "Standardize address abbreviations"
    mappings:
      - "ST → STREET"
      - "AVE → AVENUE"
      - "RD → ROAD"
      - "BLVD → BOULEVARD"
      - "HWY → HIGHWAY"
      - "CT → COURT"
      - "CIR → CIRCLE"
      - "LN → LANE"
      - "DR → DRIVE"
  
  add_city_state:
    description: "Ensure city and state in address"
    default_city: "HACKENSACK"
    default_state: "NJ"
  
  extract_block:
    description: "Extract block number from address"
    regex: "^(\\d+)"
    target_field: "block_number"
  
  standardize_officer_name:
    description: "Standardize officer name format"
    format: "[RANK] [LAST_NAME] #[BADGE]"

# ==============================
# Version History
# ==============================
versions:
  - version: "1.0.0"
    date: "2025-10-16"
    author: "R. A. Carucci"
    changes:
      - "Initial schema definition"
      - "Included all core CAD/RMS fields"
      - "Added validation rules and transformations"
